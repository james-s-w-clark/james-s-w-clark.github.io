<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Mulish:wght@300;400;600;700;800&family=Frank+Ruhl+Libre:wght@200;300;400;500;600&family=Encode+Sans+Semi+Condensed:wght@400&display=swap" rel=stylesheet><link rel=stylesheet type=text/css href=/css/bootstrap.min.css><link rel=stylesheet type=text/css href=/css/all.min.css><link disabled id=dark-mode-theme rel=stylesheet href=/css/dark.css><link rel=stylesheet type=text/css href=/css/style.css><link rel=stylesheet type=text/css href=/css/my_style.css><title>James' Digital Garden | How PDFs make your headphones sound better 🎧</title><meta name=description content="An intro to equalisers, and two ways EQ configuration can be extracted from PDFs"></head><body><nav class="navbar navbar-expand-lg navbar-light bg-light"><div class=container><a class=navbar-brand href=https://james-s-w-clark.github.io><b style=font-weight:800>JC</b></a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarNavDropdown aria-controls=navbarNavDropdown aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarNavDropdown><ul class="navbar-nav ms-auto mt-2 mt-lg-0"><li class=nav-item><a class=nav-link href=/garden/>Digital Garden</a></li><li class=nav-item><a class=nav-link href=/about/>About</a></li><li class="nav-item px-2 pt-1"><a class="btn fas fa-moon" id=dark-mode-toggle></a></li></ul></div></div></nav><div id=content><div class=container style=max-width:800px><div class="py-4 rounded-3"><div class="container-fluid py-2"><h1 class="display-2 mb-4 text-center">How PDFs make your headphones sound better 🎧</h1></div><p class="text-center fs-4 fst-italic serif">An intro to equalisers, and two ways EQ configuration can be extracted from PDFs</p><div class="text-center pt-4"></div></div><div class="row justify-content-center mb-5"><div class=col-12><p class="card-date m-0">Created Jul 20, 2022 -
Last updated: Aug 7, 2022</p><hr class=dropdown-divider><div class="row justify-content-between"><div class=col-sm-4><span class=status>Evergreen 🌳</span></div><div class=col-sm-8 style=text-align:right><span class="badge tag-badge">audio</span>
<span class="badge tag-badge">random</span></div></div></div></div><div class="container-fluid py-2"><div class="serif main-content"><p>This blog post will be a mishmash of audio equalisers and PDF text extraction.</p><p>Equalisers (EQ) let you adjust your audio to your liking. They can help all headphones try to achieve a common sound, such as the Harman Curve. There&rsquo;s loads you can read around the topic, but to keep things practical you could just give it a try and see if things &ldquo;sound better&rdquo;.<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></p><p>The user &ldquo;Oratory1990&rdquo; has <a href=https://www.reddit.com/r/oratory1990/wiki/index/list_of_presets/>measured a huge number of headphones</a> and has given equaliser settings you can try out. In the case of used Beyerdynamic DT 770 Pros, EQ will take their &ldquo;preference rating&rdquo; from 79% to 100% - basically, statistically speaking, people will like them more with EQ.</p><p>Recently the measurements and fine-tunings were adjusted for my headphones, so off I went to figure out how to use the new configuration&mldr;</p><h1 id=creating-a-parametric-eq-for-peace--equaliser-apo>Creating a parametric EQ for Peace / Equaliser APO</h1><p>In my case, I want to use the new config for Sennheiser HD 660s - see <a href="https://www.dropbox.com/s/s4isno09gt20ozf/Sennheiser%20HD660S.pdf?dl=0">this dropbox pdf</a>:</p><figure><img src=filter_settings.png width=100%></figure><p>To make this config simply and correctly, we can use an exisiting parametric EQ text file from <a href=https://github.com/jaakkopasanen/AutoEq/blob/master/results/oratory1990/harman_over-ear_2018/Sennheiser%20HD%20660%20S/Sennheiser%20HD%20660%20S%20ParametricEQ.txt>AutoEq</a>. You can see the number of filters, where the peak of each filter is centred (30Hz), how loudness changes around that frequency (6.5 dB) and the strength of the curve (Q 0.37) - as well as the shape of the curve (PK):</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Preamp: -7.0 dB
</span></span><span style=display:flex><span>Filter 1: ON PK Fc <span style=color:#ae81ff>30</span> Hz Gain 6.5 dB Q 0.37
</span></span><span style=display:flex><span>Filter 2: ON PK Fc <span style=color:#ae81ff>181</span> Hz Gain -3.8 dB Q 0.54
</span></span><span style=display:flex><span>Filter 3: ON PK Fc <span style=color:#ae81ff>1351</span> Hz Gain -3.3 dB Q 1.33
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>We can see that &ldquo;PEAK&rdquo; is abbreviated to &ldquo;PK&rdquo; - so we can guess that the low & high shelves from the diagram will be LS & HS respectively. Copying the preamp gain over and adjusting the numbers gets us:</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Preamp: -8.4 dB
</span></span><span style=display:flex><span>Filter 1: ON PK Fc <span style=color:#ae81ff>34</span> Hz Gain 3.0 dB Q 1.5
</span></span><span style=display:flex><span>Filter 2: ON LS Fc <span style=color:#ae81ff>100</span> Hz Gain 5.5 dB Q 0.71
</span></span><span style=display:flex><span>Filter 3: ON PK Fc <span style=color:#ae81ff>200</span> Hz Gain -2.5 dB Q 0.8
</span></span><span style=display:flex><span>Filter 4: ON PK Fc <span style=color:#ae81ff>1330</span> Hz Gain -2.5 dB Q 1.8
</span></span><span style=display:flex><span>Filter 5: ON HS Fc <span style=color:#ae81ff>1700</span> Hz Gain 4.0 dB Q 0.71
</span></span><span style=display:flex><span>Filter 6: ON PK Fc <span style=color:#ae81ff>3300</span> Hz Gain -2.1 dB Q 1.7
</span></span><span style=display:flex><span>Filter 7: ON PK Fc <span style=color:#ae81ff>5520</span> Hz Gain -6.4 dB Q 3.8
</span></span><span style=display:flex><span>Filter 8: ON PK Fc <span style=color:#ae81ff>8000</span> Hz Gain  3.0 dB Q 1.4
</span></span><span style=display:flex><span>Filter 9: ON HS Fc <span style=color:#ae81ff>10000</span> Hz Gain -2.0 dB Q 0.71
</span></span><span style=display:flex><span>Filter 10: OFF
</span></span></code></pre></div><p>I use Peace for Windows, so I need to import the config this way:</p><figure><img src=peace_import.png width=100%></figure><p>&mldr; and don&rsquo;t forget to save the config (feel free to choose your favourite colour icon!):</p><figure><img src=peace_save.png width=80%></figure><p>we should see that the profile is active in Peace, and in the taskbar:</p><figure><img src=peace_taskbar.png width=30%></figure><h1 id=are-there-lazier-ways-to-get-good-eq-from-these-numbers>Are there lazier ways to get good EQ from these numbers?</h1><p>Yep, like mentioned above there’s <a href=https://github.com/jaakkopasanen/AutoEq>AutoEQ</a>. The readme is good, so you can just follow that if you want more info on how to use it.</p><p>How does AutoEQ generate the EQ files?</p><p>There is a crawler python script, which:</p><ul><li><a href=https://github.com/jaakkopasanen/AutoEq/blob/master/measurements/oratory1990/oratory1990_crawler.py#L47>scans a reddit wiki</a></li><li><a href=https://github.com/jaakkopasanen/AutoEq/blob/master/measurements/oratory1990/oratory1990_crawler.py#L156>renders PDFs into images</a></li><li><a href=https://github.com/jaakkopasanen/AutoEq/blob/master/measurements/oratory1990/oratory1990_crawler.py#L81>parses the frequency graph into response curve data</a> by <a href=https://github.com/jaakkopasanen/AutoEq/blob/master/measurements/oratory1990/oratory1990_crawler.py#L128>reading the coloured data points</a></li></ul><p>As you might guess, it uses some PDF libraries, and even checks the text in the image. Instead of getting the table of data, it uses the graph to generate data. The nice thing about this is that you can independently work out graphical/parametric EQs to reach different target audio curves.</p><h1 id=how-about-automatically-reading-the-text-from-the-tables>How about automatically reading the text from the tables?</h1><p>I’m going to tell you a bit about how data is expressed in PDFs, and how we can explore PDFs to find out how we can extract useful data. You can follow along on your own PC and see what&rsquo;s going on with PDFs if you like.</p><p>Let’s see how information is expressed in PDFs:</p><ul><li><a href=https://www.reddit.com/r/oratory1990/wiki/index/list_of_presets/>Get a PDF to examine</a><ul><li>e.g. <a href="https://www.dropbox.com/s/90dggt4jel4jjgc/1More%201M301%20Single%20Driver.pdf?dl=0">1More earphones</a></li></ul></li><li><a href=https://pdfbox.apache.org/download.html>get the latest PDFBox debugger</a><ul><li>install Java if you don&rsquo;t have it</li></ul></li><li>run <code>java -jar debugger.jar</code></li><li>Open the PDF file in the debugger that pops up. It will look like:</li></ul><figure><img src=pdf_debugger.png width=100%></figure><p>If we view the contents of the file, we can view either the plaintext or encoded data stream. There’s a bunch of <strong>Stuff</strong>, but let’s look for BT (Begin Text) / ET (End Text) and see what we can read.</p><figure><img src=pdf_decoded_text.png width=100%></figure><p><code>(m) 33 (e) -44 (a) -44 (su) -44 (r) 33 (e) -44 (d) -44 ( ) -22 (o) -44 (n)</code> - &ldquo;measured on&rdquo; - that text does indeed appear in the document. What&rsquo;s with all the numbers, and having the letters in brackets? The numbers are the codepoints of glyphs+unicodes in fonts embedded in the PDF - you can see stuff like this in the font resources:</p><figure><img src=pdf_code_glyph_unicode.png width=100%></figure><p>Note that whilst the letters for &ldquo;measured on&rdquo; were at the top of the decoded stream, that doesn&rsquo;t imply where the text will be on the document. The location is defined by coordinates, like 33.06, 44.38977.</p><p>Given that I can search the PDF in a PDF viewer for “measured on” and find it, and that I can also the “Band 1” and find it - I’m pretty confident the text is expressed “plainly” in the plain text (as something like 2(b) 1(a)&mldr;).</p><p>There’s 225 “BT”s in the document. I had a flick through all of them and didn’t see something that was obviously our data. BW is the most unique short phrase in the document - can we find that? Searching for (W) gives no results. How can searches with a commercial PDF viewer find results for W? As I write this, I&rsquo;m not so sure.</p><p>We can take a step back and try some higher-level tools to keep things simple. PDFbox comes with a CLI - we can try a few commands:</p><ul><li><code>java -jar .\pdfbox-app-3.0.0-alpha3.jar</code> - shows us there&rsquo;s an &ldquo;export:text&rdquo; option</li><li><code>java -jar .\pdfbox-app-3.0.0-alpha3.jar export:text --input=pdf.pdf</code> - gives us some interesting plain-text output:</li></ul><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>...
</span></span><span style=display:flex><span>Filter Type Frequency Gain Q-Factor BW
</span></span><span style=display:flex><span>Band <span style=color:#ae81ff>1</span> PEAK <span style=color:#ae81ff>80</span> Hz -9,6 dB 0,4 3,02 Adjust gain of band <span style=color:#ae81ff>2</span> to preference <span style=color:#f92672>(</span>bass<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Band <span style=color:#ae81ff>2</span> LOW_SHELF <span style=color:#ae81ff>110</span> Hz 10,0 dB 0,71 1,89 Deviation from Target Adjust gain of band <span style=color:#ae81ff>7</span> to preference <span style=color:#f92672>(</span>airiness<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Band <span style=color:#ae81ff>3</span> PEAK <span style=color:#ae81ff>300</span> Hz -2,5 dB 1,0 1,39 Before EQ After EQ
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>Band <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>Preamp gain:
</span></span><span style=display:flex><span>-9,0 dB
</span></span></code></pre></div><figure><img src=1more_table.png width=100%></figure><p>It looks like we’ve got everthing we’d want! And look at that preference rating jump: 58 to 95. Those earphones will sound twice as good with this EQ 😉</p><p>If you’re interested in extracting this information and playing with how PDFs work, I recommend you to have a deeper look with some of these tools. It looks like you could get something working quickly with PyPDF2, to extract this text and transform it into an EQ that Peace could use. No measuring of graphs and generating of configuration needed - you can just extract the provided configuration.</p><h1 id=personalising-eq>Personalising EQ</h1><p>We mentioned Harman curves, preference ratings, EQs and stuff - but every human is different, right? Generally, the Harman target will sound good to lots of people - but some people love bass, and some people hate sibilance. A good EQ can be tweaked to personal preference.</p><p>Here&rsquo;s some notes from Oratory, then we can do a little experiment:</p><figure><img src=oratory_band_preference.png width=100%></figure><hr><figure><img src=oratory_db_tweaks.png width=100%></figure><h2 id=sibilance---electric-drum-machine>Sibilance - electric drum machine</h2><p>I listened to &ldquo;Paper Love&rdquo; by Allie X, and the hi-hat(?) on the electric drum machine was a little too loud for me - we can make it less of a focus if we want to.</p><p>To figure out where the sounds we want to change mostly lie, we can try making everything else quiet:</p><figure><img src=eq_isolate.png width=50%></figure><p>Tweaking the dials further, I figured out that -3dB at 8k and 10k was good for me. Vocals might be a <em>tiny</em> bit squashed, but the song was much easier to listen to. Optimising for listening time can be a fair goal.</p><p>I saved this config as &ldquo;660s_oratory_2022-07-15_relaxed_his&rdquo;, and with a different colour icon.</p><p>If you can&rsquo;t hear any change from moving the dials/pre-amp, you might need to restart your PC or check your Equaliser APO installation.</p><h2 id=more-basssub-bass>More bass/sub-bass</h2><p>This time we can try a different song. Choose whatever you like, or &ldquo;Regulars&rdquo; by Allie X (I do listen to other stuff, but was going through all the albums that day!). Try setting everything down and raise the sub-bass frequency:</p><figure><img src=eq_only_subbass.png width=50%></figure><p>With too much of this, there&rsquo;s mostly a kick drum(?) and muffled voices. Turn everything back else to the EQ you want and then turn the lowest frequency down - it feels a bit like you&rsquo;ve lost the &ldquo;body&rdquo;/substance of the song.</p><p>I&rsquo;m sticking with the default provided by the EQ.</p><h2 id=bass>Bass</h2><p>I tried similar for 100 Hz, so probably &ldquo;bass&rdquo; frequencies. If I took it too high, other sounds seemed to get really quiet. I&rsquo;m using a decent DAC (Schiit Modi) and amp (DIY O2), so I&rsquo;m not sure what&rsquo;s going on. But I&rsquo;m OK with Oratory&rsquo;s default, it&rsquo;s got enough bass for me.</p><p>Again, I&rsquo;m sticking with the default provided by the EQ.</p><h1 id=conclusion>Conclusion</h1><p>We&rsquo;re all different. Audio is down to preference. You might like EQ, you might not. Why not give it a try? It&rsquo;s free and could add even more enjoyment to your music listening.</p><h1 id=extra-notes>Extra notes</h1><p>Here&rsquo;s an interesting aside: sometimes PDFs are very weird about how they show text. I’ve seen what looks like totally normal documents, but on further inspection they have no actual letters in. They just have a bunch of lines and curves that looked like letters. Documents like this have to be rendered to an image and OCR’d to extract the text!
The heuristic for figuring out whether to do that is fairly simple (but expensive, so don&rsquo;t do it by default): look for a ridiculous number of lines/curves, or like 99% of the PDF operations being line/curve draws.</p><p>Here’s an example of line draws and curves in one of the docs we looked at today:</p><figure><img src=pdf_lines_curves.png width=100%></figure><p>If you want to read more about PDFs, <a href=https://opensource.adobe.com/dc-acrobat-sdk-docs/standards/pdfstandards/pdf/PDF32000_2008.pdf>this 2008 PDF .7 spec by Adobe</a> was the top Google result. It&rsquo;s more than 750 pages long. I spent a lot of time reading that thing in my first Software job 😬</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>The usage/installation guide at <a href=https://github.com/jaakkopasanen/AutoEq#usage>AutoEq</a> is pretty good. The Peace GUI makes it super easy to download and use the AutoEq settings.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div></div></div></div><div class=container><div class="row justify-content-between"><div class=col-sm-4><p class=footer>James Clark © 2024</p></div><div class="col-sm-6 d-flex flex-row-reverse"><a class="footer-social px-2" href=https://raw.githubusercontent.com/james-s-w-clark/james-s-w-clark.github.io/gh-pages/index.xml target=_blank><i class="fas fa-rss"></i></a>
<a class="footer-social px-2" href=https://github.com/james-s-w-clark target=_blank><i class="fab fa-github"></i></a>
<a class="footer-social px-2" href=https://medium.com/@james.sw.clark target=_blank><i class="fab fa-medium-m"></i></a>
<a class="footer-social px-2" href=https://www.linkedin.com/in/james-sw-clark/ target=_blank><i class="fab fa-linkedin-in"></i></a></div></div></div><script src=/js/bootstrap.min.js></script>
<script type=text/javascript src=/js/jquery.min.js></script>
<script src=/js/isotope.pkgd.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js integrity=sha384-GNFwBvfVxBkLMJpYMOABq3c+d3KnQxudP/mGPkzpZSTYykLBNsZEnG2D9G/X/+7D crossorigin=anonymous async></script>
<script src=/js/dark.js></script>
<script src=/js/isotope.js></script>
<script src=/js/mermaid.min.js></script>
<script>mermaid.initialize({startOnLoad:!0,securityLevel:"loose"})</script></body></html>
<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Mulish:wght@300;400;600;700;800&family=Frank+Ruhl+Libre:wght@200;300;400;500;600&family=Encode+Sans+Semi+Condensed:wght@400&display=swap" rel=stylesheet><link rel=stylesheet type=text/css href=/css/bootstrap.min.css><link rel=stylesheet type=text/css href=/css/all.min.css><link disabled id=dark-mode-theme rel=stylesheet href=/css/dark.css><link rel=stylesheet type=text/css href=/css/style.css><link rel=stylesheet type=text/css href=/css/my_style.css><title>James' Digital Garden | Git LFS</title><meta name=description content="what problems does it solve, and what does it cost?"></head><body><nav class="navbar navbar-expand-lg navbar-light bg-light"><div class=container><a class=navbar-brand href=https://james-s-w-clark.github.io><b style=font-weight:800>JC</b></a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarNavDropdown aria-controls=navbarNavDropdown aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarNavDropdown><ul class="navbar-nav ms-auto mt-2 mt-lg-0"><li class=nav-item><a class=nav-link href=/garden/>Digital Garden</a></li><li class=nav-item><a class=nav-link href=/about/>About</a></li><li class="nav-item px-2 pt-1"><a class="btn fas fa-moon" id=dark-mode-toggle></a></li></ul></div></div></nav><div id=content><div class=container style=max-width:800px><div class="py-4 rounded-3"><div class="container-fluid py-2"><h1 class="display-2 mb-4 text-center">Git LFS</h1></div><p class="text-center fs-4 fst-italic serif">what problems does it solve, and what does it cost?</p><div class="text-center pt-4"></div></div><div class="row justify-content-center mb-5"><div class=col-12><p class="card-date m-0">Created Jan 1, 2019 -
Last updated: Mar 17, 2019</p><hr class=dropdown-divider><div class="row justify-content-between"><div class=col-sm-4><span class=status>Growing ðŸŒ¿</span></div><div class=col-sm-8 style=text-align:right><span class="badge tag-badge">tech</span>
<span class="badge tag-badge">git</span></div></div></div></div><div class="container-fluid py-2"><div class="serif main-content"><h1 id=introduction---what-is-git-lfs>Introduction - what is Git LFS?</h1><p>Version control systems are great. Having a history which you can timetravel with is incredibly powerful.</p><p>Usually with VCS like Git or Mercurial, we when we write code we are making fairly lightweight text files. What if we want to use version history with much larger files - perhaps design assets like complex 3D videogame maps, or hi-res Photoshop drawings?</p><p>It&rsquo;s not wise to store large files like this in Git, as Git repositories store the full history: cloning a repo with 10 of our 1GB maps will be slow, as 10GB needs to download. And maybe you only need one (or even none!) of them straightaway.</p><p>&mldr; Enter Git Large File System (LFS). It allows you to save full files in remote storage, and only keep lightweight pointers to those files in your repository. Cloning the repository is fast, and you can download the large files when you need them.</p><h1 id=for-more-general-software-engineers-what-value-could-it-add>For more general software engineers, what value could it add?</h1><blockquote><p>&ldquo;But I&rsquo;m not a game developer, how can this be useful to me?&rdquo;</p></blockquote><p>Okay, here&rsquo;s the scenario I had in mind when exploring Git LFS: build systems like <a href=https://blog.gradle.org/introducing-incremental-build-support>Gradle</a>, Bazel, and mill can become much more efficient by only performing tasks when there&rsquo;s a change. If your source code hasn&rsquo;t changed, the compilation output won&rsquo;t change - so why compile anything? This avoids pointless work, saving time and money.</p><p>GitHub Actions seems to be becoming very popular now, and in theory it should integrate nicely with Git LFS <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>. Whilst some Actions can use a cache, cache is not supported for Github Enterprise >3.5. If you prefer to work smarter not harder - why make infrastructure for an S3 bucket/policies/networking if you can use easier tools? So, I wondered:</p><blockquote><p>&ldquo;Can I store build compilation output in Git LFS, i.e. as simple remote build cache&rdquo;</p></blockquote><h1 id=what-does-interacting-with-git-lfs-look-like>What does interacting with Git LFS look like?</h1><p>Let&rsquo;s say we want to push a compilation output archive (.tar.gz) on a branch <code>build-cache</code>, to hide it from <code>main</code> branch. I borrowed this idea from Github Pages being able to find static website compilations (such as from Hugo) in the <code>gh-pages</code> branch.</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>// https://git-lfs.github.com/
</span></span><span style=display:flex><span>brew install git-lfs
</span></span><span style=display:flex><span>// install various git hooks <span style=color:#00a8c8>for</span> nice git lfs syncing
</span></span><span style=display:flex><span>git lfs install
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>// in a repo
</span></span><span style=display:flex><span>git lfs track <span style=color:#d88200>&#34;*.tar.gz&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>// git attributes is now tracking this filetype with git lfs
</span></span><span style=display:flex><span>git add .gitattributes
</span></span><span style=display:flex><span>git add output.tar.gz
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>git lfs push -u origin build-cache --all
</span></span></code></pre></div><p>Now we have our archive 1. in git history, 2. in a remote object store. Let&rsquo;s go to another branch</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git checkout -b aNewBranch
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>git lfs fetch origin build-cache
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>git checkout origin/build-cache output.tar.gz
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>// check we have the actual archive, not just a pointer
</span></span><span style=display:flex><span>file output.tar.gz
</span></span></code></pre></div><p>For your curiosity, here&rsquo;s how the pointer looks:</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>version https://git-lfs.github.com/spec/v1
</span></span><span style=display:flex><span>oid sha256:c37fecb501e8ce....
</span></span><span style=display:flex><span>size <span style=color:#ae81ff>173</span>
</span></span><span style=display:flex><span>lfs-test.tar.gz <span style=color:#f92672>(</span>END<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>Fortunately, I tested this with a <em>tiny</em> archive. More on that soon.</p><h1 id=sounds-pretty-nice---what-are-the-downsides-of-build-cache-with-git-lfs>Sounds pretty nice - what are the downsides of build cache with Git LFS?</h1><p>This is where the bad news comes&mldr;</p><p>It&rsquo;s not easy to keep costs/remote storage lean with Git LFS.</p><blockquote><p>To remove Git LFS objects from a repository, delete and recreate the repository. <a href=https://docs.github.com/en/repositories/working-with-files/managing-large-files/removing-files-from-git-large-file-storage#git-lfs-objects-in-your-repository>~ Github</a></p></blockquote><p>GitHub argues they are all about keeping history, not deleting it.
Git LFS says similar. On the other hand, to clear LFS remote on GitHub you have to delete all history, so it&rsquo;s up for debate really.</p><p>Depsite a lot of <a href=https://github.com/git-lfs/git-lfs/issues/1101>desire for a smarter Git LFS for about 6 years</a>, it doesn&rsquo;t look like it&rsquo;ll be coming around any time soon. There&rsquo;s lots of great suggestions/requests, like &ldquo;last-only&rdquo; backup, and rolling backup. I wonder who is using Git LFS, and how much it costs them&mldr;</p><h2 id=what-is-the-pricing-models>What is the pricing models?</h2><h3 id=github>GitHub:</h3><ul><li><a href=https://docs.github.com/en/billing/managing-billing-for-git-large-file-storage/about-billing-for-git-large-file-storage#about-billing-for-git-large-file-storage>Free tier</a>: 1GB storage + 1GB bandwidth free per month</li><li><a href=https://docs.github.com/en/billing/managing-billing-for-git-large-file-storage/about-billing-for-git-large-file-storage#purchasing-additional-storage-and-bandwidth>Paid tiers</a>: $5 per month per 50GB storage + bandwidth</li><li><strong>Example</strong>: 1GB upload per day, 0.5GB download. First month cost: $5. Cost at 12 months: $35 per month.</li></ul><p>That&rsquo;s actually not too bad.
Using good compression to save space and bandwidth is sound advice. Bear in mind there&rsquo;s a tradeoff between using the best compression formats and algorithms VS using what people will already have (e.g. .tar.gz is decent for macos/ubuntu)
The problem comes with paying for stuff you don&rsquo;t need.</p><p>Also, be careful with bandwidth - if your quota runs out, <a href=https://docs.github.com/en/repositories/working-with-files/managing-large-files/about-storage-and-bandwidth-usage#tracking-storage-and-bandwidth-use>&ldquo;Git LFS suport is disabled&mldr;. until the next month&rdquo;</a>. I guess if you do a pull/push mechanism for build cache, you&rsquo;ll use 26GB storage but 52GB bandwidth. To reduce toil, I can foresee companies buying &ldquo;a few&rdquo; extra data packs.</p><p>It doesn&rsquo;t look like you can use a custom remote. GitHub manages it all for you, which could be a pro or a con.</p><h3 id=bitbucket>BitBucket:</h3><ul><li><a href=https://support.atlassian.com/bitbucket-cloud/docs/storage-policy-for-git-lfs-with-bitbucket/#How-much-storage-do-I-get-with-my-pricing-plan>Various free tiers</a>, 1 or 5 GB depending on use-case</li><li><a href=https://support.atlassian.com/bitbucket-cloud/docs/storage-policy-for-git-lfs-with-bitbucket/#How-much-does-additional-storage-for-Git-LFS-cost>Paid tier</a>: $10 per 100GB file storage, no mention of bandwidth</li><li><a href=https://support.atlassian.com/bitbucket-cloud/docs/manage-large-files-with-git-large-file-storage-lfs/>10GB file size limit</a> - probably plenty, but worth calling out (seen as they do!)</li></ul><p>Unlike GitHub, BitBucket has a <em>Git LFS</em> view in a settings page where <a href=https://support.atlassian.com/bitbucket-cloud/docs/use-git-lfs-with-existing-bitbucket-repositories/#Delete-Git-LFS-files-from-a-repository>LFS remote objects can be deleted</a>. Better than nothing, but there&rsquo;s toil to save these costs (and probably not worth the time for a human to do it!). As you may have guessed, <a href=https://gist.github.com/danielgindi/db0e0a897d8d920f23e155bb5d59e9c6>someone has kindly automated this</a> by running JS in Chrome&rsquo;s console.</p><h3 id=gitlab>GitLab:</h3><ul><li>You can setup custom object storage <a href=https://docs.gitlab.com/ee/administration/lfs/#storing-lfs-objects-in-remote-object-storage>via Fog</a>, e.g. on a private local network, or on aws</li><li>For deleting remote files within Gitlab&rsquo;s set of tooling/services, it doesn&rsquo;t look like it&rsquo;s an option. GitLab seem to give incorrect advice that clearing the repo should also clear the remote (<a href=https://stackoverflow.com/a/34582910/4261132>1</a>, <a href=https://gitlab.com/gitlab-org/gitlab-foss/-/issues/30639>2</a>). Someone wrote a <a href=https://github.com/darshannnn/GitLabLFS-custom_hooks>custom Ruby hook</a> to do this.</li></ul><p>If you&rsquo;re already set up with AWS, you might be interested in estimating pricing. AWS provide a <a href=https://calculator.s3.amazonaws.com/index.html>calculator</a> for that.</p><h1 id=conclusion>Conclusion</h1><p>If you <em>must</em> keep your large files versioned with Git, you can keep your repository lean with Git LFS. You just need to be aware of how costs will scale with time, and that with some Git providers you don&rsquo;t have much control over this.</p><h1 id=extra-notes>Extra notes</h1><ul><li>GitLab - <a href=https://about.gitlab.com/blog/2017/01/30/getting-started-with-git-lfs-tutorial/>getting started with Git LFS</a>. There&rsquo;s a nice little advert for Tower showing integration with Git LFS in your usual Windows/Mac file browser. That could be nice for digital artists.</li></ul><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Here&rsquo;s a <a href=https://stackoverflow.com/a/61466160/4261132>StackOverflow</a> post with example usage:</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>steps:
</span></span><span style=display:flex><span>  - name: Checkout github repo <span style=color:#f92672>(</span>+ download lfs dependencies<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    uses: actions/checkout@v3
</span></span><span style=display:flex><span>    with:
</span></span><span style=display:flex><span>      lfs: <span style=color:#111>true</span>
</span></span><span style=display:flex><span>  - name: Checkout LFS objects
</span></span><span style=display:flex><span>    run: git lfs checkout
</span></span></code></pre></div><p>For checking out the latest version of a file on a branch, it would be like <code>git checkout origin/build-cache out.tar.gz</code>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div></div></div></div><div class=container><div class="row justify-content-between"><div class=col-sm-4><p class=footer>James Clark Â© 2024</p></div><div class="col-sm-6 d-flex flex-row-reverse"><a class="footer-social px-2" href=https://raw.githubusercontent.com/james-s-w-clark/james-s-w-clark.github.io/gh-pages/index.xml target=_blank><i class="fas fa-rss"></i></a>
<a class="footer-social px-2" href=https://github.com/james-s-w-clark target=_blank><i class="fab fa-github"></i></a>
<a class="footer-social px-2" href=https://medium.com/@james.sw.clark target=_blank><i class="fab fa-medium-m"></i></a>
<a class="footer-social px-2" href=https://www.linkedin.com/in/james-sw-clark/ target=_blank><i class="fab fa-linkedin-in"></i></a></div></div></div><script src=/js/bootstrap.min.js></script>
<script type=text/javascript src=/js/jquery.min.js></script>
<script src=/js/isotope.pkgd.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js integrity=sha384-GNFwBvfVxBkLMJpYMOABq3c+d3KnQxudP/mGPkzpZSTYykLBNsZEnG2D9G/X/+7D crossorigin=anonymous async></script>
<script src=/js/dark.js></script>
<script src=/js/isotope.js></script>
<script src=/js/mermaid.min.js></script>
<script>mermaid.initialize({startOnLoad:!0,securityLevel:"loose"})</script></body></html>
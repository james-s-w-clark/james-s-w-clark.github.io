<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Mulish:wght@300;400;600;700;800&family=Frank+Ruhl+Libre:wght@200;300;400;500;600&family=Encode+Sans+Semi+Condensed:wght@400&display=swap" rel=stylesheet><link rel=stylesheet type=text/css href=/css/bootstrap.min.css><link rel=stylesheet type=text/css href=/css/all.min.css><link disabled id=dark-mode-theme rel=stylesheet href=/css/dark.css><link rel=stylesheet type=text/css href=/css/style.css><link rel=stylesheet type=text/css href=/css/my_style.css><title>James' Digital Garden | How to always know when there are PRs to check out ðŸ”®</title><meta name=description content="&mldr; I can see everything ðŸ‘€"></head><body><nav class="navbar navbar-expand-lg navbar-light bg-light"><div class=container><a class=navbar-brand href=https://james-s-w-clark.github.io><b style=font-weight:800>JC</b></a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarNavDropdown aria-controls=navbarNavDropdown aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarNavDropdown><ul class="navbar-nav ms-auto mt-2 mt-lg-0"><li class=nav-item><a class=nav-link href=/garden/>Digital Garden</a></li><li class=nav-item><a class=nav-link href=/about/>About</a></li><li class="nav-item px-2 pt-1"><a class="btn fas fa-moon" id=dark-mode-toggle></a></li></ul></div></div></nav><div id=content><div class=container style=max-width:800px><div class="py-4 rounded-3"><div class="container-fluid py-2"><h1 class="display-2 mb-4 text-center">How to always know when there are PRs to check out ðŸ”®</h1></div><p class="text-center fs-4 fst-italic serif">&mldr; I can see everything ðŸ‘€</p><div class="text-center pt-4"></div></div><div class="row justify-content-center mb-5"><div class=col-12><p class="card-date m-0">Created Aug 5, 2022 -
Last updated: Aug 5, 2022</p><hr class=dropdown-divider><div class="row justify-content-between"><div class=col-sm-4><span class=status>Seeding ðŸŒ±</span></div><div class=col-sm-8 style=text-align:right><span class="badge tag-badge">tooling</span></div></div></div></div><div class="container-fluid py-2"><div class="serif main-content"><p>A few weeks ago I heard of SwiftBar, and <a href=https://xbarapp.com/>Xbar</a>:</p><p>| Put the output from any script or program into your macOS Menu Bar</p><p>There&rsquo;s a great library of plugins on the hub, covering all sorts of topics. Want to show the weather? Show upcoming info about your favourite sports team? Check if graphics cards are in stock? It can do all of this.</p><p>What&rsquo;s also great is the fact that you can see the source code of all the plugins. You can tweak those plugins and make them your own - and it&rsquo;s interesting to understand how people solved these kinds of problems.</p><h1 id=playing-with-plugins->Playing with plugins ðŸ˜³</h1><p>I installed a few plugins, said &ldquo;wow&rdquo;, and quickly realised that the Mac Pro&rsquo;s camera notch is a bit annoying - you lose a fair bit of real estate for tools like this! I used <a href=https://github.com/Mortennn/Dozer>Dozer</a> / <a href=https://github.com/dwarvesf/hidden>Hidden</a> to get rid of a few non-essential plugins, but they take a couple icons themselves so it didn&rsquo;t help much.</p><p>This taught me that I should be as lean as possible with how many characters I display with any plugin I write. Lots of plugins stick to emojis and numbers - I agree ðŸ’¯%</p><h1 id=how-an-xbar-plugin-works>How an xbar plugin works</h1><p>The <a href=https://github.com/matryer/xbar-plugins/blob/main/CONTRIBUTING.md>docs</a> for xbar are pretty good. There&rsquo;s really two parts to a plugin: getting your data, and making xbar display it.</p><p>To show your data, you just echo/println it. How the display is structured (icon, click-on-icon-modal, etc.) is like this:</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e># Cycle through </span>
</span></span><span style=display:flex><span><span style=color:#111>echo</span> <span style=color:#d88200>&#34;cycle-one&#34;</span>
</span></span><span style=display:flex><span><span style=color:#111>echo</span> <span style=color:#d88200>&#34;cycle-two&#34;</span>
</span></span><span style=display:flex><span><span style=color:#111>echo</span> <span style=color:#d88200>&#34;cycle-three&#34;</span>
</span></span><span style=display:flex><span><span style=color:#111>echo</span> <span style=color:#d88200>&#34;---&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Next lines only visible in dropdown for this plugin</span>
</span></span><span style=display:flex><span><span style=color:#111>echo</span> <span style=color:#d88200>&#34;dropdown-item1&#34;</span>
</span></span><span style=display:flex><span><span style=color:#111>echo</span> <span style=color:#d88200>&#34;dropdown-item2&#34;</span>
</span></span><span style=display:flex><span><span style=color:#111>echo</span> <span style=color:#d88200>&#34;--dropdown-item2-something&#34;</span>
</span></span><span style=display:flex><span><span style=color:#111>echo</span> <span style=color:#d88200>&#34;----dropdown-item2-something-yodawg&#34;</span>
</span></span><span style=display:flex><span><span style=color:#111>echo</span> <span style=color:#d88200>&#34;--dropdown-item2-somethingElse&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Next item is also in dropdown, separated by horizontal bar</span>
</span></span><span style=display:flex><span><span style=color:#111>echo</span> <span style=color:#d88200>&#34;---&#34;</span>
</span></span><span style=display:flex><span><span style=color:#111>echo</span> <span style=color:#d88200>&#34;dropdown-item3&#34;</span>
</span></span></code></pre></div><figure><img src=xbar_tree.jpg width=100%></figure><p>I think that&rsquo;s far more nesting that I&rsquo;d ever want to use - but it&rsquo;s nice that it&rsquo;s there if you want it. I guess somebody did!</p><p>Anyway, you can put links/colours/shortcuts in there and make it clickable. You can do other stuff like have the user enter variables (&lt;xbar.var>) for the program to access as environment variables (it can&rsquo;t access your actual environment variables).</p><p>Another key feature is deciding how often your plugin updates. The plugin filenames should have a format of {name}.{time}.{ext}, e.g. check_weather.15m.sh.</p><h1 id=writing-an-xbar-plugin>Writing an xbar plugin</h1><p>Lots of teams use Github PRs. xbar seemed like the perfect tool for me to monitor PRs. I&rsquo;ve tried a few systems for monitoring PRs, but I&rsquo;m not a fan of any of them:</p><ul><li>I don&rsquo;t like <em>email</em> spam (one more app/tab, multitasking)</li><li><em>Chatbots</em> are either slow (quickly oudated) or spammy</li><li><em>Manually checking the site</em> either needs a few page loads or a bookmark - either way, it&rsquo;s not the smoothest experience&mldr; but the problem for me is it doesn&rsquo;t say in advance if there will be any information for you to act on</li></ul><h2 id=goals>Goals</h2><p>I figured an xbar plugin would let me:</p><ul><li>know if I can to merge (required approval count is met, CI checks pass)</li><li>know if I have any comments/suggestions to address</li><li>get a count of how many PRs other people have open</li><li>get a count of how many PRs other people need reviews on</li><li>see if PR checks pass/fail</li><li>do this over multiple repositories</li></ul><p>Your ideology on PRs probably makes you question these goals&mldr; but you can tweak plugins, and you can tweak them to match your ideologies.</p><h1 id=writing-this-plugin-with-bash>Writing this plugin with bash</h1><p>The Github CLI is quite powerful - it can handle a lot of complexity with a clean API:</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#111>username</span><span style=color:#f92672>=</span><span style=color:#d88200>$&#34;james&#34;</span>
</span></span><span style=display:flex><span><span style=color:#111>repo</span><span style=color:#f92672>=</span><span style=color:#d88200>$&#34;ourOrg/ourBigRepo&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#111>all_prs</span><span style=color:#f92672>=</span><span style=color:#00a8c8>$(</span>gh pr list --repo <span style=color:#111>$repo</span><span style=color:#00a8c8>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#111>echo</span> <span style=color:#d88200>&#34;</span><span style=color:#111>$all_prs</span><span style=color:#d88200>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#111>my_prs</span><span style=color:#f92672>=</span><span style=color:#00a8c8>$(</span>gh pr list --repo WeaponX/ourBigRepo --author <span style=color:#111>$username</span><span style=color:#00a8c8>)</span>
</span></span><span style=display:flex><span><span style=color:#111>echo</span> <span style=color:#d88200>&#34;</span><span style=color:#111>$my_prs</span><span style=color:#d88200>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># TODO take to browser with --web</span>
</span></span></code></pre></div><p>There&rsquo;s a lot of <a href=https://cli.github.com/manual/gh_pr_list>options/args</a> you can use, and other handy commands like <a href=https://cli.github.com/manual/gh_pr_status>gh pr status</a>. The CLI can natively output to json or use jq filters.</p><p>I had a think about how I&rsquo;d use this to tick off those goals, but for me it seemed easier to use a language I&rsquo;m more familar with.</p><ul><li>node.js<ul><li><ul><li>I get higher order functions (map, filter, reduce, etc.) which can help me focus on what I want, not how to do it</li></ul></li><li><ul><li>might need a global npm install of axios for making requests</li></ul></li><li><del>- need to figure out how to run a node file as a bash-like file ()</del><ul><li>that only took a second to find out and verify - <a href=https://stackoverflow.com/a/24183402/4261132>it&rsquo;s pretty much what you&rsquo;d expect</a></li></ul></li></ul></li><li>scala<ul><li>it&rsquo;s the language I work with, so it&rsquo;d be good to practice more</li><li><a href=https://scala-cli.virtuslab.org/docs/guides/scripts#self-executable-scala-script>scala-cli</a> can let you write self-executable scala scripts<ul><li>I was curious how the experience would be, so I went with this</li></ul></li></ul></li></ul><p>Of course, sticking with bash would be nice. The Github CLI could be used for simplicity, which some users may already have - or curl could be used for even fewer dependencies. I encourage anyone who finds that challenge interesting to give it a try!</p><h1 id=writing-this-plugin-with-bash-scala>Writing this plugin with <del>bash</del> Scala</h1><p>The first question is: Node has Axios, Python has Requests&mldr; but what&rsquo;s nice and simple for Scala? Enter Li Haoyi&rsquo;s <a href=https://github.com/com-lihaoyi/requests-scala>requests-scala</a>. Let&rsquo;s install <a href=https://scala-cli.virtuslab.org/install>scala-cli</a> and have a try:</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env -S scala-cli shebang
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>import <span style=color:#111>$ivy</span>.<span style=color:#d88200>`</span>com.lihaoyi::requests:0.7.1<span style=color:#d88200>`</span>
</span></span><span style=display:flex><span>import <span style=color:#111>$ivy</span>.<span style=color:#d88200>`</span>com.lihaoyi::ujson:2.0.0<span style=color:#d88200>`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>val <span style=color:#111>resp</span> <span style=color:#f92672>=</span> requests.get<span style=color:#f92672>(</span><span style=color:#d88200>&#34;https://api.github.com/users/lihaoyi&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>val <span style=color:#111>data</span> <span style=color:#f92672>=</span> ujson.read<span style=color:#f92672>(</span>resp.text<span style=color:#f92672>())</span>
</span></span><span style=display:flex><span>println<span style=color:#f92672>(</span>data<span style=color:#f92672>(</span><span style=color:#d88200>&#34;login&#34;</span><span style=color:#f92672>))</span> <span style=color:#75715e># username</span>
</span></span></code></pre></div><p>It&rsquo;s close, it just needs a little tweak to the suggested shebang: for my MacOs brew install, <code>#!/usr/bin/env /opt/homebrew/bin/scala-cli</code> works. Scala-cli is pulling in those Ivy dependencies and using them, very nice.</p><p>To keep the blog short, you can what I&rsquo;ve got so far here: <a href=https://github.com/james-s-w-clark/xbar-github-pr>xbar-github-pr</a>. At this time it just shows PR counts summed over multiple repositories for your PRs and others'.</p><p>TODO - add a screenshot&mldr; or maybe in the goals section to get interest earlier?</p><p>For now it&rsquo;s basic but it&rsquo;s a useful gauge/reminder. It can definitely be more useful, and meet more of the <a href=#goals>goals</a> we set up. At some point I&rsquo;ll extend on it, make it more idiomatic, and clean it up. It&rsquo;s pretty much a dirty POC at the time of writing, but nevertheless I wanted to share it.</p><p>Also note it was written for Github Enterprise, so might need a few small tweaks to work for public repos (mostly around the URLs used). Be respectful your scripts&rsquo; frequency (remember, it&rsquo;s in the filename, e.g. <code>github-pr-checker.1h.sc</code>)</p><p>Writing scripts with Scala-cli was generally pleasant, and I will likely reach for it again when solving similar problems - however I couldn&rsquo;t figure out how to have a great user experience. There are <a href=https://scala-cli.virtuslab.org/docs/commands/setup-ide/>IDE setup docs for scala-cli</a>, which could have helped improve highlighting or autocompletion. They do acknowledge <a href=https://scala-cli.virtuslab.org/docs/guides/ide/>IDE user experience could be better</a>.</p><h1 id=but-im-on-windows--linux>But I&rsquo;m on Windows / Linux</h1><p>todo: have a look for alternatives that use plugins and thus could use this stuff too</p></div></div></div></div><div class=container><div class="row justify-content-between"><div class=col-sm-4><p class=footer>James Clark Â© 2024</p></div><div class="col-sm-6 d-flex flex-row-reverse"><a class="footer-social px-2" href=https://raw.githubusercontent.com/james-s-w-clark/james-s-w-clark.github.io/gh-pages/index.xml target=_blank><i class="fas fa-rss"></i></a>
<a class="footer-social px-2" href=https://github.com/james-s-w-clark target=_blank><i class="fab fa-github"></i></a>
<a class="footer-social px-2" href=https://medium.com/@james.sw.clark target=_blank><i class="fab fa-medium-m"></i></a>
<a class="footer-social px-2" href=https://www.linkedin.com/in/james-sw-clark/ target=_blank><i class="fab fa-linkedin-in"></i></a></div></div></div><script src=/js/bootstrap.min.js></script>
<script type=text/javascript src=/js/jquery.min.js></script>
<script src=/js/isotope.pkgd.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js integrity=sha384-GNFwBvfVxBkLMJpYMOABq3c+d3KnQxudP/mGPkzpZSTYykLBNsZEnG2D9G/X/+7D crossorigin=anonymous async></script>
<script src=/js/dark.js></script>
<script src=/js/isotope.js></script>
<script src=/js/mermaid.min.js></script>
<script>mermaid.initialize({startOnLoad:!0,securityLevel:"loose"})</script></body></html>
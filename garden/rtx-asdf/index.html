<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Mulish:wght@300;400;600;700;800&family=Frank+Ruhl+Libre:wght@200;300;400;500;600&family=Encode+Sans+Semi+Condensed:wght@400&display=swap" rel=stylesheet><link rel=stylesheet type=text/css href=/css/bootstrap.min.css><link rel=stylesheet type=text/css href=/css/all.min.css><link disabled id=dark-mode-theme rel=stylesheet href=/css/dark.css><link rel=stylesheet type=text/css href=/css/style.css><link rel=stylesheet type=text/css href=/css/my_style.css><title>James' Digital Garden | RTX ON - it's execution time</title><meta name=description content="&mldr; it&rsquo;s never been easier to get set up"></head><body><nav class="navbar navbar-expand-lg navbar-light bg-light"><div class=container><a class=navbar-brand href=https://james-s-w-clark.github.io><b style=font-weight:800>JC</b></a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarNavDropdown aria-controls=navbarNavDropdown aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarNavDropdown><ul class="navbar-nav ms-auto mt-2 mt-lg-0"><li class=nav-item><a class=nav-link href=/garden/>Digital Garden</a></li><li class=nav-item><a class=nav-link href=/about/>About</a></li><li class="nav-item px-2 pt-1"><a class="btn fas fa-moon" id=dark-mode-toggle></a></li></ul></div></div></nav><div id=content><div class=container style=max-width:800px><div class="py-4 rounded-3"><div class="container-fluid py-2"><h1 class="display-2 mb-4 text-center">RTX ON - it's execution time</h1></div><p class="text-center fs-4 fst-italic serif">&mldr; it&rsquo;s never been easier to get set up</p><div class="text-center pt-4"></div></div><div class="row justify-content-center mb-5"><div class=col-12><p class="card-date m-0">Created Jul 21, 2023 -
Last updated: Jul 21, 2023</p><hr class=dropdown-divider><div class="row justify-content-between"><div class=col-sm-4><span class=status>Evergreen ðŸŒ³</span></div><div class=col-sm-8 style=text-align:right><span class="badge tag-badge">Tooling</span></div></div></div></div><div class="container-fluid py-2"><div class="serif main-content"><p>I&rsquo;ve been using previously used <code>sdkman</code> for a few years to manage my JDK & Scala installations. It supports a good amount of tooling, but it&rsquo;s very JVM focused. You may know <code>nvm</code> or <code>n</code> for managing and switching Node versions, or Volta/fnm for more general Javascript tooling management.</p><p>Recently I&rsquo;ve been getting into Elixir & Phoenix LiveView, and I came across a similar tool called <code>asdf</code>. Actually though, thanks to its &ldquo;plugins&rdquo; system and almost 700 plugins, you can install so many different tools. Sounds good to me - I have projects using Python, Elixir, Java/Scala, Node, Terraform, AWS CLI, etc.. With one application, I can have tooling defined locally (per-project) so it&rsquo;s all independent and easy to get the tooling right.</p><p>This was working great for Elixir & Erlang, but the ergonomics felt a little off. In order to list versions, you have to first download the plugin. And due to its &ldquo;shim&rdquo; mechanism, it adds about 100ms delay to each command that passes through the asdf executable (my ELI5 understanding).</p><p>I then came across <a href=https://github.com/jdxcode/rtx>rtx</a>, a Rust tool inspired by <code>asdf</code> that takes a different approach. Here&rsquo;s some features I&rsquo;m really liking:</p><ul><li>Speed - <code>rtx</code> points to tooling versions via the PATH, and updates the PATH when necessary - this keeps interactions fast (it doesn&rsquo;t go through a &ldquo;shim&rdquo; unless it has to, unlike <code>asdf</code>)<ul><li>Also, apparently <code>python</code> called via <code>rtx</code> is much more response than <code>python</code> with <code>pyenv</code></li></ul></li><li>Installs - If you have a bunch of microservices on different Node/Java versions, <code>rtx</code> reloads the relevant version via the PATH when you switch project in your terminal. You don&rsquo;t need to run commands like <code>nvm use node 16</code> - it&rsquo;s automatic. Global installs are supported too.</li><li>Plugins - <code>asdf</code>&rsquo;s amazing plugins are here still, but you don&rsquo;t have to explicltly install them first!<ul><li><code>rtx</code> does have it&rsquo;s own plugins, but &lt;10 at the time of writing. Re-using asdf&rsquo;s plugins is smart</li></ul></li><li>Documentation - the CLI & interactions are friendly, and setup is (almost) frictionless</li><li>Configuration - <code>.rtx.toml</code> and the CLI interactions with it are easy to use, and really powerful - see below!</li></ul><h1 id=show-me-the-config>Show me the config</h1><p>For our documentation website, I suggested we move from install nvm/node/yarn/sbt to just this configuration file (.rtx.toml):</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#111>[</span><span style=color:#75af00>tools</span><span style=color:#111>]</span>
</span></span><span style=display:flex><span><span style=color:#75af00>node</span> <span style=color:#111>=</span> <span style=color:#d88200>&#34;16&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75af00>yarn</span> <span style=color:#111>=</span> <span style=color:#d88200>&#34;1.22.19&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75af00>sbt</span> <span style=color:#111>=</span> <span style=color:#d88200>&#34;1.9.2&#34;</span>
</span></span></code></pre></div><p>and this one-click script (in IntelliJ) to go from 0 to READY:</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl https://rtx.pub/install.sh <span style=color:#111>|</span> sh <span style=color:#75715e># install rtx </span>
</span></span><span style=display:flex><span><span style=color:#111>echo</span> <span style=color:#d88200>&#39;eval &#34;$(~/bin/rtx activate zsh)&#34;&#39;</span> &gt;&gt; ~/.zshrc <span style=color:#75715e># hook rtx into shell</span>
</span></span><span style=display:flex><span>rtx install <span style=color:#75715e># install tooling</span>
</span></span><span style=display:flex><span>yarn <span style=color:#75715e># install deps </span>
</span></span><span style=display:flex><span>yarn run <span style=color:#75715e># launch dev website</span>
</span></span></code></pre></div><p>That&rsquo;s a nice developer experience. I&rsquo;m happy to know someone can clone a repo, click a button, grab a drink, and come back to a website!</p><hr><h1 id=ci---does-it-add-value-here>CI - does it add value here?</h1><p>So, <code>rtx</code> is pretty cool for local development - but what about CI?</p><p>For our main project, we use a JDK, Scala, and Mill.
There&rsquo;s a few Actions for setup (setup-java, coursier-setup, mill-setup, etc.) - but they usually want a version typing out. This could lead to drift between development and CI, and introduce a bit of toil when somebody finally notices or remembers.</p><p><a href=https://github.com/actions/setup-java>setup-java</a></p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>steps</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>uses</span><span style=color:#111>:</span> <span style=color:#ae81ff>actions/checkout@v3</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>uses</span><span style=color:#111>:</span> <span style=color:#ae81ff>actions/setup-java@v3</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>with</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>distribution</span><span style=color:#111>:</span> <span style=color:#d88200>&#39;openjdk&#39;</span> <span style=color:#75715e># See &#39;Supported distributions&#39; for available options</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>java-version</span><span style=color:#111>:</span> <span style=color:#d88200>&#39;17&#39;</span>
</span></span></code></pre></div><p>But it&rsquo;d be nice if we could set up more, with less lines right? See <a href=https://github.com/coursier/setup-action>Coursier&rsquo;s setup-action</a>:</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>steps</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>uses</span><span style=color:#111>:</span> <span style=color:#ae81ff>actions/checkout@v3</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>uses</span><span style=color:#111>:</span> <span style=color:#ae81ff>coursier/setup-action@v1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>with</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>jvm</span><span style=color:#111>:</span> <span style=color:#ae81ff>adopt:17</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>apps</span><span style=color:#111>:</span> <span style=color:#ae81ff>sbtn bloop ammonite</span>
</span></span></code></pre></div><p>Ah, so it seems the versions can&rsquo;t be specified (other than for the jvm).</p><p>With the <a href=https://github.com/marketplace/actions/rtx-action>rtx Action</a>, our <code>.rtx.toml</code> files can be used - which is accurate, and brief:</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>steps</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>uses</span><span style=color:#111>:</span> <span style=color:#ae81ff>actions/checkout@v3</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>uses</span><span style=color:#111>:</span> <span style=color:#ae81ff>jdxcode/rtx-action@v1</span>
</span></span></code></pre></div><p>I ran <a href=https://github.com/IdiosApps/havvk/blob/master/.github/workflows/rtx-action-check.yml>this</a> as a workflow dispatch. The first run took 3m36s (it takes a while locally to install Elixir & Erlang too), but <a href=https://github.com/IdiosApps/havvk/actions/runs/5627022179/job/15248908167>the second run (started soon after) took only 20 seconds</a>! GitHub Actions seems to have nicely cached the worker for my <code>master</code> branch (270MB total). Apparently there&rsquo;s a <a href=https://docs.github.com/en/actions/using-workflows/caching-dependencies-to-speed-up-workflows>10GB total limit</a> - though I can&rsquo;t see how long it lasts. That&rsquo;s cool though - our action <em>just works</em> in CI, is super clean, and in Public GitHub they help us keep things fast with zero-configuration caches!</p><h1 id=-but-my-versions-for-different-tools-are-scattered-around-my-source>&mldr; but my versions for different tools are scattered around my source!</h1><p>Let&rsquo;s say you use three tools, which are specified in different files:</p><ul><li>openjdk-17 - in a Dockerfile</li><li>Scala 2.13.xy - in a Dependencies.sc file</li><li>mill - in .mill-version</li></ul><p>Fortunately, <code>rtx</code> uses the <code>tera</code> templating engine so we can grab these dynamically.
These commands are kinda grim (I couldn&rsquo;t use " or &lsquo;; I found <code>cut</code> to be a good command, thanks ChatGPT), but are probably &ldquo;good enough&rdquo; to not need updating. The sources they read won&rsquo;t be changing spacing much:</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#111>[</span><span style=color:#75af00>tools</span><span style=color:#111>]</span>
</span></span><span style=display:flex><span><span style=color:#75af00>mill</span> <span style=color:#111>=</span> <span style=color:#111>{</span> <span style=color:#75af00>version</span> <span style=color:#111>=</span> <span style=color:#d88200>&#34;{{exec(command=&#39;echo $(cat .mill-version)&#39;)}}&#34;</span> <span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#75af00>java</span> <span style=color:#111>=</span> <span style=color:#111>{</span> <span style=color:#75af00>version</span> <span style=color:#111>=</span> <span style=color:#d88200>&#34;{{exec(command=&#39;grep -m 1 openjdk docker/Dockerfile | cut -c 12- | tr : -&#39;)}}&#34;</span> <span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#75af00>scala</span> <span style=color:#111>=</span> <span style=color:#111>{</span> <span style=color:#75af00>version</span> <span style=color:#111>=</span> <span style=color:#d88200>&#34;{{exec(command=&#39;grep -m 1 2.13 dependencies/Dependencies.sc | cut -c 33-39&#39;)}}&#34;</span> <span style=color:#111>}</span>
</span></span></code></pre></div><p>The secret sauce here is:</p><ul><li><code>grep -m 1 &lt;phrase></code> returns the first line that matches</li><li><code>cut 12-</code> gives from the 12th char onwards, <code>cut 33-39</code> does what you&rsquo;d think</li></ul><p>Yep, it does look dumb, but:</p><ul><li>For Java we just pin to a major version; if we stick to the same vendor, there&rsquo;ll be no issue</li><li>For Mill, it&rsquo;s just a plain cat. Not too bad :)</li><li>For Scala, until there&rsquo;s a migration to Scala 3 then we&rsquo;ll just see 2.13.11 -> 2.13.xy</li></ul><h1 id=additions--alternatives>Additions & Alternatives</h1><ul><li>For <code>asdf</code>, there is <a href=https://github.com/mhanberg/lazyasdf>lazyasdf</a> - it&rsquo;s a TUI for <code>asdf</code> (like how k9s is a TUI for k8s)</li><li>An alternative to <code>asdf</code>/<code>rtx</code> is <a href=https://github.com/aquaproj/aqua>aqua</a>, written in Go. The local configuration (like .rtx.toml) is aqua.yaml, and it supports global installs too<ul><li>The <a href=https://github.com/aquaproj/aqua-registry/tree/main/pkgs>Aqua registry</a> has gives 1200+ results - but I see nothing for Elixir, Java/JDK/JVM, and the only node result is &ldquo;kubectl-node-shell&rdquo;</li><li>The fzf-esque interactive search for packages with <code>aqua g</code> is nice, even if I can&rsquo;t find what I want</li></ul></li></ul><h1 id=whats-bad-about-rtx-security>What&rsquo;s bad about rtx (security)?</h1><p>There&rsquo;s a good <a href=https://github.com/jdxcode/rtx/blob/main/SECURITY.md>security write-up on the rtx repo</a>.</p><p>As you can see, with Tera templating you can run some arbitrary commands (firstly in PRs/GitHub Actions, then locally if a change is merged). There is a command <a href=https://github.com/jdxcode/rtx#rtx-trust-options-config_file>rtx trust</a>, meaning &ldquo;rtx will parse the file with potentially dangerous
features enabled&rdquo; - I guess that&rsquo;d be useful if you clone some OSS repo and don&rsquo;t want the tooling. There&rsquo;s also configuration via environment variables, e.g. <a href=https://github.com/jdxcode/rtx#rtx_trusted_config_paths>RTX_TRUSTED_CONFIG_PATHS</a> that may be useful.</p><p>Even tools like <a href=https://github.com/IdiosApps/dependabot-gradlewrapper-test#what-are-some-problems-with-the-gradle-wrapper>gradlew have risks</a> though, and that&rsquo;s massively popular.</p><p>To answer &ldquo;can/should I use rtx?&rdquo;, at this point you need to do your own homework ;)</p><h1 id=conclusion>Conclusion</h1><p>I encourage you to give <a href=https://github.com/jdxcode/rtx>rtx</a> a try. It&rsquo;ll be my tooling manager of choice for personal projects now, and I&rsquo;m encourgaging its use at work. So far I&rsquo;m using it in a backend JVM repo, a yarn/node documentation repo, and an Elixir/Erlang repo.</p></div></div></div></div><div class=container><div class="row justify-content-between"><div class=col-sm-4><p class=footer>James Clark Â© 2024</p></div><div class="col-sm-6 d-flex flex-row-reverse"><a class="footer-social px-2" href=https://raw.githubusercontent.com/IdiosApps/IdiosApps.github.io/gh-pages/index.xml target=_blank><i class="fas fa-rss"></i></a>
<a class="footer-social px-2" href=https://github.com/IdiosApps target=_blank><i class="fab fa-github"></i></a>
<a class="footer-social px-2" href=https://medium.com/@james.sw.clark target=_blank><i class="fab fa-medium-m"></i></a>
<a class="footer-social px-2" href=https://www.linkedin.com/in/james-sw-clark/ target=_blank><i class="fab fa-linkedin-in"></i></a></div></div></div><script src=/js/bootstrap.min.js></script>
<script type=text/javascript src=/js/jquery.min.js></script>
<script src=/js/isotope.pkgd.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js integrity=sha384-GNFwBvfVxBkLMJpYMOABq3c+d3KnQxudP/mGPkzpZSTYykLBNsZEnG2D9G/X/+7D crossorigin=anonymous async></script>
<script src=/js/dark.js></script>
<script src=/js/isotope.js></script>
<script src=/js/mermaid.min.js></script>
<script>mermaid.initialize({startOnLoad:!0,securityLevel:"loose"})</script></body></html>